<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<base href="{{ base }}" >
		<title>{{ title }}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
		<link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
		<link rel="stylesheet" href="assets/css/bootstrap.min.css">
		<link rel="stylesheet" href="assets/css/bible.css">
		<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
		<script src="plugins/jquery/jquery.min.js"></script>
		<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script language="javascript">
			var data = {{ body|raw }};
		</script>
	</head>
	<body>
 <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="/bible">{{ title }}</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto"></ul>
          <form class="form-inline mt-2 mt-md-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form>
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <main role="main" class="row" >
		<div class="col-md-3 sidebar">
		   <ul class="nav flex-column" id="apps">

           </ul>
		</div>
		<div class="col-md-9">

		</div>

    </main>

    <footer class="footer">
      <div class="container">
        <span class="text-muted">Auto generated by EVO Bible.</span>
      </div>
    </footer>

	</body>
</html>

<template name="menuitem">
	<li class="nav-item">
        <a class="nav-link active" href="/bible?app=${name}">${name}</a>
    </li>
</template>
<script>
	$(document).ready(function() {
	  $.each(data,function(k,app) {
		if(app.name == ""){
		    app.name = app.namespace
		}
		var html = parseTpl($("template[name=menuitem]").html(), app);
		$("#apps").append(html)
	  })
	})

	function get(path, obj, fb = `$\{${path}}`) {
      return path.split('.').reduce((res, key) => res[key] || fb, obj);
    }

    function parseTpl(template, map, fallback) {
      return template.replace(/\$\{.+?}/g, (match) => {
        const path = match.substr(2, match.length - 3).trim();
        return get(path, map, fallback);
      });
    }
</script>